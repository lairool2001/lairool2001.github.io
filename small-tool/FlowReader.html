<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="content-language" content="zh-tw">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>fr</title>
    <style type="text/css">
	body{
		margin:0;
		text-align:center;
		padding:0;
		line-height:0;
	}
	.div1{
		position: inline-block;
		border:none;
		width:100%;
	}
	br{
		height:0px;
		position:relative;
	}
	img{
		width:100%;
	}
	#control_fix{
		position:fixed;
		diplay:inline;
	}
	#text_width{
		display:inline;
		width:50px;
		font-size:20px;
	}
    </style>
</head>

<body>
	<div id="control_fix">
		<button onclick="onClickWidth(100)" >100%</button>
		<button onclick="onClickWidth(75)" >75%</button>
		<button onclick="onClickWidth(50)" >50%</button>
		<input type="text" id="text_width" value="100" onchange="onChange2(event)"></input>%
	</div>
    <input type="file" id="file1" onchange="onChange(event);" webkitdirectory mozdirectory></input>
	<pre>padding-top padding-right padding-bottom padding-left</pre>
	<input type="text" id="text1" value="0px 0px 0px 0px"></input>
	<div id="div1"></div>
	<script>
		Element.prototype.documentOffsetTop = function () {
			return this.offsetTop + ( this.offsetParent ? this.offsetParent.documentOffsetTop() : 0 );
		};
		nowItem=null
		function onClickWidth(w){
			if(nowItem!= null){
				/*nowItem.scrollIntoView(true)
				itemTop=document.body
				nowItem.scrollIntoView(false)*/
				
				/*var top =nowItem.documentOffsetTop() - ( window.innerHeight / 2 );
				window.scrollTo( 0, top+nowItem.height/2 );*/
				
				var min=Infinity 
				var minElement=null
				var viewMiddleY=window.scrollY+document.documentElement.clientHeight/2
				for(var i=0;i<imgz.length;i++){
					var img=imgz[i]
					var elementMiddleY=img.offsetTop +img.offsetHeight/2
					var v=Math.abs(elementMiddleY-viewMiddleY)
					if(v<min ){
						min=v
						minElement=img
					}
				}
				$("img").css("width",w+"%");
				minElement.scrollIntoView(true)
			}
			console.log("change")
		}
		function onChange(e){
			var filesX = e.target.files;
			files=[...filesX]
			//sort
			files.sort((a,b)=> a.name.match(/\d+/)-b.name.match(/\d+/));
			//files.sort((a,b)=> a.name-b.name);
			console.log(files)
			let listing = div1;	//(透過id)取得要放置圖片的標籤位置
			listing.innerHTML=""
			imgz=[]
			for(let i=0; i<files.length; i++) {
				let item = document.createElement("img");	//產生圖片標籤
				item.src = URL.createObjectURL(files[i])
				//files[i].webkitRelativePath;	//設定圖片的來源位置
				item.style.padding = text1.value; //排版用
				item.onmouseenter=()=>{
					nowItem=item
					console.log(nowItem)
				}
				imgz.push(item)
				listing.appendChild(item);
				let br=document.createElement("br")
				listing.appendChild(br)
				//alert(files[i].webkitRelativePath);
			}
		}
		function onChange2(e){
			var re = /^[0-9]+$/;
			if (re.test(text_width.value)){
				onClickWidth(text_width.value)
			}
		}
	</script>
</body>

</html>
